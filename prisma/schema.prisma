//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["auth", "workspace", "development", "storage"]
}

generator client {
  provider        = "prisma-client-js"
  output          = "../node_modules/.prisma/client"
  previewFeatures = ["multiSchema"]
}

generator dbComments {
  provider = "prisma-db-comments-generator"
}

generator erdDiagram {
  provider              = "prisma-grapher"
  output                = "../prisma/docs/ERD.svg"
  disabled              = false
  ignoreEnums           = false
  title                 = "PatrolSix Schema"
  lineColor             = "#004cff"
  headerBackgroundColor = "#bacefc"
  headerForegroundColor = "black"
  bodyBackgroundColor   = "white"
  bodyBackgroundColor2  = "#e8efff"
  bodyForegroundColor   = "black"
  typeForegroundColor   = "#4f83ff"
}

/// Status options for entities like workspaces, clients, and locations
enum EntityStatus {
  /// Fully operational
  ACTIVE   @map("active")
  /// Permanently disabled
  DISABLED @map("disabled")
  /// Marked for deletion
  DELETED  @map("deleted")

  @@map("entity_status_enum")
  @@schema("workspace")
}

/// Security event types for audit logging
enum AuditLogEventType {
  CREATE                   @map("create")
  UPDATE                   @map("update")
  DELETE                   @map("delete")
  ARCHIVE                  @map("archive")
  RESTORE                  @map("restore")
  LOGIN                    @map("login")
  LOGOUT                   @map("logout")
  LOGIN_FAILED             @map("login_failed")
  SESSION_EXPIRED          @map("session_expired")
  SESSION_REVOKED          @map("session_revoked")
  ACCOUNT_CREATED          @map("account_created")
  ACCOUNT_UPDATED          @map("account_updated")
  ACCOUNT_DELETED          @map("account_deleted")
  PERMISSION_GRANTED       @map("permission_granted")
  PERMISSION_REVOKED       @map("permission_revoked")
  ACCESS_DENIED            @map("access_denied")
  PASSWORD_CHANGED         @map("password_changed")
  PASSWORD_RESET           @map("password_reset")
  PASSWORD_CHANGE_REQUIRED @map("password_change_required")
  SUSPICIOUS_ACTIVITY      @map("suspicious_activity")
  ERROR                    @map("error")

  @@map("audit_log_event_type_enum")
  @@schema("auth")
}

enum AuditLogResourceType {
  USER           @map("user")
  SESSION        @map("session")
  PERMISSION     @map("permission")
  WORKSPACE      @map("workspace")
  CLIENT         @map("client")
  LOCATION       @map("location")
  VERIFICATION   @map("verification")
  OAUTH_ACCOUNT  @map("oauth_account")
  FILE           @map("file")
  INCIDENT       @map("incident")
  GUARD          @map("guard")
  DEVICE         @map("device")
  SETTING        @map("setting")
  SECURITY_EVENT @map("security_event")
  AUTH_ERROR     @map("auth_error")

  @@map("audit_log_resource_type_enum")
  @@schema("auth")
}

enum AuditSeverityLevel {
  INFO     @map("info")
  WARNING  @map("warning")
  ERROR    @map("error")
  CRITICAL @map("critical")
  ALERT    @map("alert")

  @@map("audit_severity_level_enum")
  @@schema("auth")
}

/// Authentication methods supported by the platform
enum AuthenticationMethod {
  /// Standard password authentication
  PASSWORD   @map("password")
  /// One-time password via SMS/phone
  PHONE_OTP  @map("phone_otp")
  /// Magic link via email
  MAGIC_LINK @map("magic_link")
  /// OAuth provider authentication
  OAUTH      @map("oauth")
  /// WebAuthn/passkey authentication
  WEBAUTHN   @map("webauthn")

  @@map("authentication_method_enum")
  @@schema("auth")
}

/// OAuth provider options
enum OAuthProvider {
  /// Google authentication
  GOOGLE    @map("google")
  /// GitHub authentication
  GITHUB    @map("github")
  /// Microsoft authentication
  MICROSOFT @map("microsoft")
  /// Apple authentication
  APPLE     @map("apple")

  @@map("oauth_provider_enum")
  @@schema("auth")
}

/// OAuth scope permissions
enum OAuthScope {
  /// Access to email
  EMAIL    @map("email")
  /// Access to profile information
  PROFILE  @map("profile")
  /// OpenID Connect
  OPENID   @map("openid")
  /// Calendar access
  CALENDAR @map("calendar")
  /// Drive/storage access
  DRIVE    @map("drive")

  @@map("oauth_scope_enum")
  @@schema("auth")
}

/// Platform user status options
enum PlatformUserStatus {
  /// User is active and can access the platform
  ACTIVE    @map("active")
  /// User is inactive and cannot access the platform
  INACTIVE  @map("inactive")
  /// User is suspended due to violations
  SUSPENDED @map("suspended")
  /// User account is pending verification
  PENDING   @map("pending")
  /// User account has been deleted
  DELETED   @map("deleted")

  @@map("platform_user_status_enum")
  @@schema("auth")
}

/// Verification token types
enum VerificationTokenType {
  EMAIL_VERIFICATION @map("email_verification")
  PHONE_VERIFICATION @map("phone_verification")
  PASSWORD_RESET     @map("password_reset")
  ACCOUNT_DELETION   @map("account_deletion")

  @@map("verification_token_type_enum")
  @@schema("auth")
}

enum PermissionType {
  PLATFORM_ADMIN   @map("platform_admin")
  PLATFORM_USER    @map("platform_user")
  WORKSPACE_ADMIN  @map("workspace_admin")
  WORKSPACE_EDITOR @map("workspace_editor")
  WORKSPACE_VIEWER @map("workspace_viewer")
  CLIENT_ADMIN     @map("client_admin")
  CLIENT_EDITOR    @map("client_editor")
  CLIENT_VIEWER    @map("client_viewer")
  LOCATION_ADMIN   @map("location_admin")
  LOCATION_EDITOR  @map("location_editor")
  LOCATION_VIEWER  @map("location_viewer")

  @@map("permission_type_enum")
  @@schema("auth")
}

/// Status options for incident tracking
enum IncidentStatus {
  /// Newly reported incident
  REPORTED      @map("reported")
  /// Under investigation
  INVESTIGATING @map("investigating")
  /// Resolution in progress
  IN_PROGRESS   @map("in_progress")
  /// Resolution complete
  RESOLVED      @map("resolved")
  /// Incident closed
  CLOSED        @map("closed")

  @@map("incident_status_enum")
  @@schema("workspace")
}

/// Severity levels for incidents
enum IncidentSeverity {
  /// Critical impact requiring immediate attention
  CRITICAL @map("critical")
  /// High impact requiring urgent attention
  HIGH     @map("high")
  /// Moderate impact requiring normal attention
  MEDIUM   @map("medium")
  /// Low impact, can be handled routinely
  LOW      @map("low")

  @@map("incident_severity_enum")
  @@schema("workspace")
}

/// Categories for incident classification
enum IncidentCategory {
  /// Security-related incidents
  SECURITY    @map("security")
  /// Safety-related incidents
  SAFETY      @map("safety")
  /// Maintenance-related incidents
  MAINTENANCE @map("maintenance")
  /// Other uncategorized incidents
  OTHER       @map("other")

  @@map("incident_category_enum")
  @@schema("workspace")
}

enum SeedExecutionStatus {
  RUNNING   @map("running")
  COMPLETED @map("completed")
  FAILED    @map("failed")

  @@map("seed_execution_status")
  @@schema("development")
}

/// Platform user model with authentication capabilities
model PlatformUser {
  createdAt              DateTime               @default(now()) @map("created_at")
  updatedAt              DateTime               @updatedAt() @map("updated_at")
  lastModifiedBy         String?                @map("last_modified_by")
  deletedAt              DateTime?              @map("deleted_at")
  deletedBy              String?                @map("deleted_by")
  id                     String                 @id() @default(cuid(2))
  emailAddress           String?                @unique() @map("email_address")
  emailAddressVerifiedAt DateTime?              @map("email_address_verified_at")
  phoneNumber            String?                @unique() @map("phone_number")
  phoneNumberVerifiedAt  DateTime?              @map("phone_number_verified_at")
  name                   String
  passwordHash           String?                @map("password_hash")
  passwordLastChanged    DateTime?              @map("password_last_changed")
  requirePasswordChange  Boolean                @default(false) @map("require_password_change")
  passwordResetAttempts  Int                    @default(0) @map("password_reset_attempts")
  lockoutUntil           DateTime?              @map("lockout_until")
  mfaEnabled             Boolean                @default(false) @map("mfa_enabled")
  authenticationMethods  AuthenticationMethod[]
  status                 PlatformUserStatus     @default(ACTIVE)
  lastLoginAt            DateTime?              @map("last_login_at")
  failedLoginAttempts    Int                    @default(0) @map("failed_login_attempts")
  lockedUntil            DateTime?              @map("locked_until")
  sessions               AuthSession[]
  oauthAccounts          OAuthAccount[]
  permissions            Permission[]
  assignedIncidents      Incident[]             @relation("AssignedIncidents")
  personProfile          PersonProfile?         @relation(fields: [personProfileId], references: [id])
  personProfileId        String?                @unique() @map("person_profile_id")
  profilePicture         ObjectStorageFile?     @relation("ProfilePicture", fields: [profilePictureId], references: [id])
  profilePictureId       String?                @unique() @map("profile_picture_id")

  @@index([deletedAt])
  @@map("platform_users")
  @@schema("auth")
}

/// Authentication session for a user
model AuthSession {
  id           String       @id() @default(cuid(2))
  user         PlatformUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       String       @map("user_id")
  token        String       @unique()
  expiresAt    DateTime     @map("expires_at")
  lastActiveAt DateTime     @map("last_active_at")
  ipAddress    String?      @map("ip_address")
  userAgent    String?      @map("user_agent")
  deviceInfo   Json?
  geoLocation  Json?        @map("geo_location")
  isRevoked    Boolean      @default(false) @map("is_revoked")
  revokedAt    DateTime?    @map("revoked_at")

  @@index([userId])
  @@map("auth_sessions")
  @@schema("auth")
}

/// Audit log for security events
model AuditLog {
  id           String               @id() @default(cuid(2))
  eventType    AuditLogEventType    @map("event_type")
  resourceType AuditLogResourceType @map("resource_type")
  resourceId   String               @map("resource_id")
  userId       String               @map("user_id")
  severity     AuditSeverityLevel   @default(INFO)
  description  String
  metadata     Json?
  success      Boolean              @default(true)

  @@index([eventType])
  @@index([resourceType, resourceId])
  @@index([userId])
  @@map("audit_logs")
  @@schema("auth")
}

/// OAuth account linked to a platform user
model OAuthAccount {
  id                String        @id() @default(cuid(2))
  user              PlatformUser  @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId            String        @map("user_id")
  provider          OAuthProvider
  providerAccountId String        @map("provider_account_id")
  accessToken       String        @map("access_token")
  refreshToken      String?       @map("refresh_token")
  expiresAt         DateTime?     @map("expires_at")
  tokenType         String        @map("token_type")
  scope             String?
  idToken           String?       @map("id_token")
  sessionState      String?       @map("session_state")

  @@unique([provider, providerAccountId])
  @@map("oauth_accounts")
  @@schema("auth")
}

/// Verification token for email/phone verification
model VerificationToken {
  id         String                @id() @default(cuid(2))
  identifier String
  token      String                @unique()
  type       VerificationTokenType
  expiresAt  DateTime              @map("expires_at")

  @@unique([identifier, token])
  @@map("verification_tokens")
  @@schema("auth")
}

model Permission {
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt() @map("updated_at")
  lastModifiedBy String?        @map("last_modified_by")
  deletedAt      DateTime?      @map("deleted_at")
  deletedBy      String?        @map("deleted_by")
  id             String         @id() @default(cuid(2))
  user           PlatformUser   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String         @map("user_id")
  type           PermissionType
  workspaceId    String?        @map("workspace_id")
  workspace      Workspace?     @relation("WorkspacePermissions", fields: [workspaceId], references: [id], onDelete: Cascade)
  clientId       String?        @map("client_id")
  client         Client?        @relation("ClientPermissions", fields: [clientId], references: [id], onDelete: Cascade)
  locationId     String?        @map("location_id")
  location       Location?      @relation("LocationPermissions", fields: [locationId], references: [id], onDelete: Cascade)
  lastAccessedAt DateTime?      @map("last_accessed_at")

  @@unique([userId, type, workspaceId, clientId, locationId])
  @@index([deletedAt])
  @@index([userId])
  @@index([type])
  @@index([workspaceId])
  @@index([clientId])
  @@index([locationId])
  @@map("permissions")
  @@schema("auth")
}

model PersonProfile {
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt() @map("updated_at")
  lastModifiedBy String?       @map("last_modified_by")
  deletedAt      DateTime?     @map("deleted_at")
  deletedBy      String?       @map("deleted_by")
  id             String        @id() @default(cuid(2))
  firstName      String        @map("first_name")
  lastName       String?       @map("last_name")
  user           PlatformUser?

  @@index([deletedAt])
  @@map("person_profiles")
  @@schema("auth")
}

/// Security incident record
model Incident {
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt() @map("updated_at")
  lastModifiedBy     String?             @map("last_modified_by")
  deletedAt          DateTime?           @map("deleted_at")
  deletedBy          String?             @map("deleted_by")
  id                 String              @id() @default(cuid(2))
  /// Incident title/summary
  title              String
  /// Detailed incident description
  description        String?
  /// Current incident status
  status             IncidentStatus      @default(REPORTED)
  /// When the incident occurred
  occurredAt         DateTime            @map("occurred_at")
  /// Address where incident occurred
  address            Json?
  /// Related file attachments
  attachments        ObjectStorageFile[] @relation("IncidentAttachments")
  /// Incident severity
  severity           IncidentSeverity    @default(MEDIUM)
  /// Incident category
  category           IncidentCategory    @default(OTHER)
  /// Time to first response in minutes
  responseTime       Int?                @map("response_time")
  /// Time to resolution in minutes
  resolutionTime     Int?                @map("resolution_time")
  /// Assigned user for handling the incident
  assignedTo         PlatformUser?       @relation("AssignedIncidents", fields: [assignedToId], references: [id])
  assignedToId       String?             @map("assigned_to_id")
  /// When the incident was assigned
  assignedAt         DateTime?           @map("assigned_at")
  /// Priority level (1-5)
  priority           Int?
  /// Due date for resolution
  dueDate            DateTime?           @map("due_date")
  /// Tags for categorization
  tags               String[]
  /// Related incidents
  relatedIncidents   Incident[]          @relation("RelatedIncidents")
  relatedToIncidents Incident[]          @relation("RelatedIncidents")
  /// Client where incident occurred
  client             Client              @relation(fields: [clientId], references: [id], onDelete: Cascade)
  clientId           String              @map("client_id")
  /// Location where incident occurred
  location           Location            @relation(fields: [locationId], references: [id])
  locationId         String              @map("location_id")

  @@index([deletedAt])
  @@index([status, severity])
  @@index([assignedToId])
  @@index([dueDate])
  @@map("incident")
  @@schema("workspace")
}

/// File stored in object storage (S3, Azure, GCP)
model ObjectStorageFile {
  id             String        @id() @default(cuid())
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt()
  objectKey      String        @unique()
  objectBucket   String
  sizeInBytes    Int
  mimeType       String        @map("mime_type")
  metadata       Json?
  profilePicture PlatformUser? @relation("ProfilePicture")
  incidents      Incident[]    @relation("IncidentAttachments")

  @@map("object_storage_files")
  @@schema("storage")
}

/// Client organization within a workspace
model Client {
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt() @map("updated_at")
  lastModifiedBy String?      @map("last_modified_by")
  deletedAt      DateTime?    @map("deleted_at")
  deletedBy      String?      @map("deleted_by")
  id             String       @id() @default(cuid(2))
  /// Display name of the client
  name           String
  /// Optional client description
  description    String?
  /// URL to client logo image
  logoUrl        String?      @map("logo_url")
  /// Current client status
  status         EntityStatus @default(ACTIVE)
  /// Client configuration settings
  settings       Json?
  /// Physical address information
  address        Json?
  /// Parent workspace
  workspace      Workspace    @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  workspaceId    String       @map("workspace_id")
  /// Physical locations
  locations      Location[]
  permissions    Permission[] @relation("ClientPermissions")
  /// Maximum number of locations allowed
  maxLocations   Int?         @map("max_locations")
  /// Incidents
  incidents      Incident[]

  @@index([deletedAt])
  @@index([workspaceId])
  @@map("client")
  @@schema("workspace")
}

/// Customer organization workspace
model Workspace {
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt() @map("updated_at")
  lastModifiedBy String?      @map("last_modified_by")
  deletedAt      DateTime?    @map("deleted_at")
  deletedBy      String?      @map("deleted_by")
  id             String       @id() @default(cuid(2))
  /// Display name of the workspace
  name           String
  /// URL-friendly unique identifier
  slug           String       @unique()
  /// URL to workspace logo image
  logoUrl        String?      @map("logo_url")
  /// Optional workspace description
  description    String?
  /// Current workspace status
  status         EntityStatus @default(ACTIVE)
  /// Workspace configuration settings
  settings       Json?
  /// Physical address information
  address        Json?
  /// Client organizations
  clients        Client[]
  permissions    Permission[] @relation("WorkspacePermissions")
  /// Workspace features
  features       String[]

  @@index([deletedAt])
  @@index([slug])
  @@map("workspace")
  @@schema("workspace")
}

/// Physical location for a client
model Location {
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt() @map("updated_at")
  lastModifiedBy   String?      @map("last_modified_by")
  deletedAt        DateTime?    @map("deleted_at")
  deletedBy        String?      @map("deleted_by")
  id               String       @id() @default(cuid(2))
  /// Display name of the location
  name             String
  /// Optional location description
  description      String?
  /// Current location status
  status           EntityStatus @default(ACTIVE)
  /// Physical address information
  address          Json?
  /// Location configuration settings
  locationSettings Json?        @map("location_settings")
  /// Parent client
  client           Client       @relation(fields: [clientId], references: [id], onDelete: Cascade)
  clientId         String       @map("client_id")
  incidents        Incident[]
  permissions      Permission[] @relation("LocationPermissions")

  @@index([deletedAt])
  @@index([clientId])
  @@map("location")
  @@schema("workspace")
}

/// Tracks database seed executions for development and testing
model SeedExecution {
  id          String              @id() @default(cuid(2))
  seedName    String              @map("seed_name")
  executedAt  DateTime            @default(now()) @map("executed_at")
  completedAt DateTime?           @map("completed_at")
  status      SeedExecutionStatus @default(RUNNING)
  error       String?
  metadata    Json?

  @@unique([seedName, executedAt])
  @@index([status])
  @@index([seedName, status])
  @@map("seed_execution")
  @@schema("development")
}
